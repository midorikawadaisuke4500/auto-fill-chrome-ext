# システム開発仕様書：自動入力補完Chrome拡張機能

## 1. システム概要

本システムは、様々なウェブサイの「ログイン画面」「注文/申込画面（氏名・住所等）」のDOM構造の違いを吸収し、最短距離での自動入力を実現するChrome拡張機能である。

## 2. アーキテクチャ構成 (3-Tier)

1. **Chrome拡張機能 (Frontend + Logic):** DOM解析、多段ステップ実行制御、暗号化/復号化（マスターパスワード）
2. **データ中継API (GAS + Google Sheets):** サイトごとの入力シナリオJSONの配信、SMS認証コードの一時保存
3. **モバイル連動 (iOS Shortcuts):** 端末に着信したSMSコードをAPIへ転送

## 3. 主要機能要件

### 拡張機能本体

* **EXT-01 URL自動検知:** 現在のタブURLとデータベースのURLパターンをマッチング
* **EXT-02 DOM要素特定:** XPath/CSSセレクタによる柔軟な要素指定
* **EXT-03 マスターパスワード認証:** 拡張機能起動時にパスワード要求、メモリ上で一時保持
* **EXT-04 暗号化保存:** クレデンシャル情報はAES-256で暗号化して保存
* **EXT-05 SMSコード自動転記:** GASから最新の認証コードを取得し入力
* **EXT-06 新規登録時保管:** 未知のログイン成功を検知し、暗号化して記録
* **EXT-07 多段実行フロー:** ページ遷移を伴う複数ステップの入力（Nextボタンクリック等）
* **EXT-08 オーバーレイUI:** 同一サイトでの複数アカウント切り替え
* **EXT-09 フルオートモード:** 確認不要の完全自動サブミット（フラグ管理）

### API・データベース

* **API-01:** プロファイル/シナリオ取得
* **API-02:** 新規クレデンシャル登録
* **API-03:** SMSコード受信・保存
* **DB-01:** サイト別シナリオテーブル定義
* **DB-02:** ユーザープロファイルテーブル定義
* **DB-03:** SMSコードキャッシュテーブル

## 4. 非機能要件

* **セキュリティ:** クライアント側でのみ復号（Zero-Knowledge的アプローチ）。GAS上には平文パスワードを置かない。
* **DOM動的対応:** MutationObserverを利用し、SPAや遅延レンダリング要素の出現を待機する。

## 5. JSONシナリオ構造例

```json
{
  "site_id": "example",
  "url_pattern": "example.com/login",
  "steps": [
    {
      "step": 1,
      "action": "input",
      "target_selector": "input[name='email']",
      "data_key": "profile.email"
    },
    {
      "step": 2,
      "action": "click",
      "target_selector": "button#next"
    }
  ]
}
```
